{% extends 'dashboard.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/patients/patient_list.css') }}">
    <title>Patients</title>
</head>

<h2>Patients List</h2>

<form method="GET" 
      action="{{ url_for('patients.get_worker_patients') if current_user.role == 'worker' else url_for('patients.pneumonia_cases') }}" 
      class="search-container">
    <input type="text" name="search" placeholder="Search Patient..." value="{{ search_query }}">
    <input type="hidden" name="filter" value="{{ filter_type }}">
    <button type="submit">Search</button>
</form>

<div class="table-container">
    <table class="patient-table">
        <thead>
            {% if current_user.role == "worker" %}
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>DoB</th>
                    <th>Last Updated</th>
                    <th>Clinician Notes</th>
                    <th>Actions</th>
                </tr>
            {% else %}
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Condition</th>
                    <th>Clinician Notes</th>
                </tr>
            {% endif %}
        </thead>
        <tbody>
            {% for patient in patients %}
                {% if current_user.role == "worker" %}
                    <tr>
                        <td>{{ patient.first_name }} {{ patient.surname }}</td>
                        <td>{{ patient.email }}</td>
                        <td>{{ patient.phone }}</td>
                        <td>{{ patient.dob }}</td>
                        <td> {{ patient.last_updated }}</td>
                        <td>{{ patient.clinician_note }}</td>
                        <td class="action-buttons">
                            <a href="{{ url_for('patients.edit_patient', id=patient.id) }}">
                                <button class="edit-btn">Edit</button>
                            </a>
                            <form action="{{ url_for('patients.delete_existing_patient', id=patient.id) }}" method="post" style="display:inline;">
                                <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete {{ patient.first_name }} {{ patient.surname }}?');">
                                    Delete
                                </button>
                            </form>
                            <a href="{{ url_for('patients.edit_patient', id=patient.id) }}">
                                <button class="email-btn">Email</button>
                            </a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td>{{ patient.first_name }} {{ patient.surname }}</td>
                        <td>{{ "Pneumonia" if patient.ai_suspected else "No issues detected" }}</td>
                        <td>{{ "Confirmed Pneumonia" if patient.verified_ai else "Not Pneumonia" }}</td>
                        <td>{{ patient.clinician_note }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
